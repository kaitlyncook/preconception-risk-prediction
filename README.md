# Preconception Prediction of Pregnancy Outcomes
This repository contains all functions necessary to implement the multistate competing risks framework described in the manuscript "A multistate competing risks framework for preconception prediction of pregnancy outcomes", as well as a sample script illustrating the model estimation and validation pipeline. This project was co-authored by Kaitlyn Cook (Harvard Medical School and Harvard Pilgrim Health Care Insitute), Neil J. Perkins (Eunice Kennedy Shriver National Institute of Child Health and Human Development), Enrique Schisterman (Perelman School of Medicine, University of Pennsylvania), and Sebastien Haneuse (Harvard T.H. Chan School of Public Health).

## File Description
The scripts require that the following packages are installed in R: *discSurv*, *glmnet*, *gtools*, *MASS*, *mice*, and *nnet*. Once these packages are installed (the scripts will load them as needed), and once the working directory has been set to the location of the `preconception-risk-prediction` repository on the local machine, the code should run without error.
* **preconception-prediction-script.R**: Illustrates estimation and validation of a multistate competing risks model for preconception prediction of pregnancy outcomes in the [Effects of Aspirin in Gestation and Reproduction (EAGeR)](http://www.thelancet.com/journals/lancet/article/PIIS0140-6736(14)60157-4/fulltext) trial population. Sources **risk-prediction-functions.R** and **calcHUM-IPW.R**.
* **risk-prediction-functions.R**: Contains all functions needed to (a) clean the original/imputed analysis datasets; (b) select and fit the first-stage, second-stage, and IPW models; (c) obtain estimated preconception risk profiles; and (d) estimate the optimism of the in-sample prediction performance assessment (HUM).
* **calcHUM-IPW.R**: Contains the R wrapper function for **loop.c**.
* **loop.c**: C++ implementation of the verification-bias-adjusted HUM estimator under <img src="https://render.githubusercontent.com/render/math?math=k = 4"> outcome categories. This code will need to be compiled locally before running or sourcing any of the previous scripts. Instructions for compilation are given in the file header, and the *GNU Scientific Library (gsl)* will need to be installed locally. This code is heavily adapted from code written by Kyu Ha Lee (Harvard T.H. Chan School of Public Health) and Catherine Lee (Kaiser Permanente) for unadjusted HUM estimators.

## Data
The de-identified EAGeR data used in **preconception-prediction-script.R** are available on reasonable request. Please contact [Kaitlyn Cook (kacook17@gmail.com)](mailto:kacook17@gmail.com) with questions or requests.
